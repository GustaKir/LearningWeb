Title: C API Enhancements in Python
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This section details recent updates to the Python C API, including undefined macros for `Py_LIMITED_API`, the addition of new Unicode comparison functions, and error handling improvements in the `PyStructSequence` constructor.
---

### C API[¶](https://docs.python.org/3/whatsnew/changelog.html#id140 "Link to this heading")
  * [gh-85283](https://github.com/python/cpython/issues/85283): If the [`Py_LIMITED_API`](https://docs.python.org/3/c-api/stable.html#c.Py_LIMITED_API "Py_LIMITED_API") macro is defined, `Py_BUILD_CORE`, `Py_BUILD_CORE_BUILTIN` and `Py_BUILD_CORE_MODULE` macros are now undefined by `<Python.h>`. Patch by Victor Stinner.
  * [gh-110289](https://github.com/python/cpython/issues/110289): Add [`PyUnicode_EqualToUTF8AndSize()`](https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_EqualToUTF8AndSize "PyUnicode_EqualToUTF8AndSize") and [`PyUnicode_EqualToUTF8()`](https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_EqualToUTF8 "PyUnicode_EqualToUTF8") functions.
  * [gh-110235](https://github.com/python/cpython/issues/110235): Raise [`TypeError`](https://docs.python.org/3/library/exceptions.html#TypeError "TypeError") for duplicate/unknown fields in `PyStructSequence` constructor. Patched by Xuehai Pan.
  * [gh-110014](https://github.com/python/cpython/issues/110014): Remove undocumented `PY_TIMEOUT_MAX` constant from the limited C API. Patch by Victor Stinner.
  * [gh-109521](https://github.com/python/cpython/issues/109521): [`PyImport_GetImporter()`](https://docs.python.org/3/c-api/import.html#c.PyImport_GetImporter "PyImport_GetImporter") now sets RuntimeError if it fails to get [`sys.path_hooks`](https://docs.python.org/3/library/sys.html#sys.path_hooks "sys.path_hooks") or [`sys.path_importer_cache`](https://docs.python.org/3/library/sys.html#sys.path_importer_cache "sys.path_importer_cache") or they are not list and dict correspondingly. Previously it could return NULL without setting error in obscure cases, crash or raise SystemError if these attributes have wrong type.
  * [gh-108724](https://github.com/python/cpython/issues/108724): Add [`PyMutex`](https://docs.python.org/3/c-api/init.html#c.PyMutex "PyMutex") internal-only lightweight locking API.
  * [gh-85283](https://github.com/python/cpython/issues/85283): Add [`PySys_AuditTuple()`](https://docs.python.org/3/c-api/sys.html#c.PySys_AuditTuple "PySys_AuditTuple") function: similar to [`PySys_Audit()`](https://docs.python.org/3/c-api/sys.html#c.PySys_Audit "PySys_Audit"), but pass event arguments as a Python [`tuple`](https://docs.python.org/3/library/stdtypes.html#tuple "tuple") object. Patch by Victor Stinner.
  * [gh-108867](https://github.com/python/cpython/issues/108867): Add [`PyThreadState_GetUnchecked()`](https://docs.python.org/3/c-api/init.html#c.PyThreadState_GetUnchecked "PyThreadState_GetUnchecked") function: similar to [`PyThreadState_Get()`](https://docs.python.org/3/c-api/init.html#c.PyThreadState_Get "PyThreadState_Get"), but don’t kill the process with a fatal error if it is NULL. The caller is responsible to check if the result is NULL. Previously, the function was private and known as `_PyThreadState_UncheckedGet()`. Patch by Victor Stinner.
  * [gh-108765](https://github.com/python/cpython/issues/108765): `Python.h` no longer includes the `<ctype.h>` standard header file. If needed, it should now be included explicitly. For example, it provides `isalpha()` and `tolower()` functions which are locale dependent. Python provides locale independent functions, like `Py_ISALPHA()` and `Py_TOLOWER()`. Patch by Victor Stinner.
  * [gh-108765](https://github.com/python/cpython/issues/108765): `Python.h` no longer includes the `<unistd.h>` standard header file. If needed, it should now be included explicitly. For example, it provides the functions: `close()`, `getpagesize()`, `getpid()` and `sysconf()`. Patch by Victor Stinner.
  * [gh-108765](https://github.com/python/cpython/issues/108765): `Python.h` no longer includes the `<ieeefp.h>` standard header. It was included for the `finite()` function which is now provided by the `<math.h>` header. It should now be included explicitly if needed. Remove also the `HAVE_IEEEFP_H` macro. Patch by Victor Stinner.
  * [gh-108765](https://github.com/python/cpython/issues/108765): `Python.h` no longer includes these standard header files: `<time.h>`, `<sys/select.h>` and `<sys/time.h>`. If needed, they should now be included explicitly. For example, `<time.h>` provides the `clock()` and `gmtime()` functions, `<sys/select.h>` provides the `select()` function, and `<sys/time.h>` provides the `futimes()`, `gettimeofday()` and `setitimer()` functions. Patch by Victor Stinner.
  * [gh-108511](https://github.com/python/cpython/issues/108511): Add functions [`PyObject_HasAttrWithError()`](https://docs.python.org/3/c-api/object.html#c.PyObject_HasAttrWithError "PyObject_HasAttrWithError"), [`PyObject_HasAttrStringWithError()`](https://docs.python.org/3/c-api/object.html#c.PyObject_HasAttrStringWithError "PyObject_HasAttrStringWithError"), [`PyMapping_HasKeyWithError()`](https://docs.python.org/3/c-api/mapping.html#c.PyMapping_HasKeyWithError "PyMapping_HasKeyWithError") and [`PyMapping_HasKeyStringWithError()`]