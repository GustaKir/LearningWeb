Title: Python Updates and Bug Fixes
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This document details patches by Kumar Aditya, including the preservation of 'extra' fields in `zipfile` for zip64 compatibility, and fixes for segmentation faults in `lzma.LZMADecompressor` and `bz2.BZ2Decompressor` when initialized improperly. It also addresses leakage issues in these decompressor and compressor classes.
---

Patch by Kumar Aditya.
  * [gh-88233](https://github.com/python/cpython/issues/88233): Correctly preserve “extra” fields in `zipfile` regardless of their ordering relative to a zip64 “extra.”
  * [bpo-23224](https://bugs.python.org/issue?@action=redirect&bpo=23224): Fix segfaults when creating [`lzma.LZMADecompressor`](https://docs.python.org/3/library/lzma.html#lzma.LZMADecompressor "lzma.LZMADecompressor") and [`bz2.BZ2Decompressor`](https://docs.python.org/3/library/bz2.html#bz2.BZ2Decompressor "bz2.BZ2Decompressor") objects without calling `__init__()`, and fix leakage of locks and internal buffers when calling the `__init__()` methods of [`lzma.LZMADecompressor`](https://docs.python.org/3/library/lzma.html#lzma.LZMADecompressor "lzma.LZMADecompressor"), [`lzma.LZMACompressor`](https://docs.python.org/3/library/lzma.html#lzma.LZMACompressor "lzma.LZMACompressor"), [`bz2.BZ2Compressor`](https://docs.python.org/3/library/bz2.html#bz2.BZ2Compressor "bz2.BZ2Compressor"), and [`bz2.BZ2Decompressor`](https://docs.python.org/3/library/bz2.html#bz2.BZ2Decompressor "bz2.BZ2Decompressor") objects multiple times.


### Documentation[¶](https://docs.python.org/3/whatsnew/changelog.html#id163 "Link to this heading")
  * [gh-85417](https://github.com/python/cpython/issues/85417): Update [`cmath`](https://docs.python.org/3/library/cmath.html#module-cmath "cmath: Mathematical functions for complex numbers.") documentation to clarify behaviour on branch cuts.
  * [gh-97725](https://github.com/python/cpython/issues/97725): Fix [`asyncio.Task.print_stack()`](https://docs.python.org/3/library/asyncio-task.html#asyncio.Task.print_stack "asyncio.Task.print_stack") description for `file=None`. Patch by Oleg Iarygin.


### Tests[¶](https://docs.python.org/3/whatsnew/changelog.html#id164 "Link to this heading")
  * [gh-102019](https://github.com/python/cpython/issues/102019): Fix deadlock on shutdown if `test_current_{exception,frames}` fails. Patch by Jacob Bower.
  * [gh-85984](https://github.com/python/cpython/issues/85984): Utilize new “winsize” functions from termios in pty tests.
  * [gh-89792](https://github.com/python/cpython/issues/89792): `test_tools` now copies up to 10x less source data to a temporary directory during the `freeze` test by ignoring git metadata and other artifacts. It also limits its python build parallelism based on os.cpu_count instead of hard coding it as 8 cores.


### Build[¶](https://docs.python.org/3/whatsnew/changelog.html#id165 "Link to this heading")
  * [gh-99942](https://github.com/python/cpython/issues/99942): On Android, in a static build, python-config in embed mode no longer incorrectly reports a library to link to.
  * [gh-99942](https://github.com/python/cpython/issues/99942): On Android, python.pc now correctly reports the library to link to, the same as python-config.sh.
  * [gh-100221](https://github.com/python/cpython/issues/100221): Fix creating install directories in `make sharedinstall` if they exist outside `DESTDIR` already.
  * [gh-96821](https://github.com/python/cpython/issues/96821): Explicitly mark C extension modules that need defined signed integer overflow, and add a configure option [`--with-strict-overflow`](https://docs.python.org/3/using/configure.html#cmdoption-with-strict-overflow). Patch by Matthias Görgens and Shantanu Jain.


### Windows[¶](https://docs.python.org/3/whatsnew/changelog.html#id166 "Link to this heading")
  * [gh-102344](https://github.com/python/cpython/issues/102344): Implement `winreg.QueryValue` using `QueryValueEx` and `winreg.SetValue` using `SetValueEx`. Patch by Max Bachmann.
  * [gh-101881](https://github.com/python/cpython/issues/101881): Handle read and write operations on non-blocking pipes properly on Windows.
  * [gh-101881](https://github.com/python/cpython/issues/101881): Add support for the os.get_blocking() and os.set_blocking() functions on Windows.
  * [gh-101849](https://github.com/python/cpython/issues/101849): Ensures installer will correctly upgrade existing `py.exe` launcher installs.
  * [gh-101763](https://github.com/python/cpython/issues/101763): Updates copy of libffi bundled with Windows installs to 3.4.4.
  * [gh-101759](https://github.com/python/cpython/issues/101759): Update Windows installer to SQLite 3.40.1.
  * [gh-101614](https://github.com/python/cpython/issues/101614): Correctly handle extensions built against debug binaries that reference `python3_d.dll`.
  * [gh-101196](https://github.com/python/cpython/issues/101196): The functions `os.path.isdir`, `os.path.isfile`, `os.path.islink` and `os.path.exists` are now 13% to 28% faster on Windows, by making fewer Win32 API calls.


### macOS[¶](https://docs.python.org/3/whatsnew/changelog.html#id167 "Link to this heading")
  * [gh-101759](https://github.com/python/cpython/issues/101759): Update macOS installer to SQLite 3.40.1.