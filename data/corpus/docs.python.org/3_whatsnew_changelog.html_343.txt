Title: Testing Enhancements and Fixes
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This section details various improvements and fixes related to tests in Python, including adjustments to `import_fresh_module()`, the addition of a test case for `typing.NamedTuple`, handling of invalid `markers` in `c_make_encoder`, and resolution of issues in `test_multiprocessing_fork` and `sys.modules` manipulation.
---

### Tests[¶](https://docs.python.org/3/whatsnew/changelog.html#id282 "Link to this heading")
  * [bpo-40173](https://bugs.python.org/issue?@action=redirect&bpo=40173): Fix [`test.support.import_helper.import_fresh_module()`](https://docs.python.org/3/library/test.html#test.support.import_helper.import_fresh_module "test.support.import_helper.import_fresh_module").
  * [bpo-45280](https://bugs.python.org/issue?@action=redirect&bpo=45280): Add a test case for empty [`typing.NamedTuple`](https://docs.python.org/3/library/typing.html#typing.NamedTuple "typing.NamedTuple").
  * [bpo-45269](https://bugs.python.org/issue?@action=redirect&bpo=45269): Cover case when invalid `markers` type is supplied to `c_make_encoder`.
  * [bpo-45128](https://bugs.python.org/issue?@action=redirect&bpo=45128): Fix `test_multiprocessing_fork` failure due to `test_logging` and `sys.modules` manipulation.
  * [bpo-45209](https://bugs.python.org/issue?@action=redirect&bpo=45209): Fix `UserWarning: resource_tracker` warning in `_test_multiprocessing._TestSharedMemory.test_shared_memory_cleaned_after_process_termination`
  * [bpo-45185](https://bugs.python.org/issue?@action=redirect&bpo=45185): Enables `TestEnumerations` test cases in `test_ssl` suite.
  * [bpo-45195](https://bugs.python.org/issue?@action=redirect&bpo=45195): Fix test_readline.test_nonascii(): sometimes, the newline character is not written at the end, so don’t expect it in the output. Patch by Victor Stinner.
  * [bpo-45156](https://bugs.python.org/issue?@action=redirect&bpo=45156): Fixes infinite loop on [`unittest.mock.seal()`](https://docs.python.org/3/library/unittest.mock.html#unittest.mock.seal "unittest.mock.seal") of mocks created by `create_autospec()`.
  * [bpo-45125](https://bugs.python.org/issue?@action=redirect&bpo=45125): Improves pickling tests and docs of `SharedMemory` and `SharableList` objects.
  * [bpo-44860](https://bugs.python.org/issue?@action=redirect&bpo=44860): Update `test_sysconfig.test_user_similar()` for the posix_user scheme: `platlib` doesn’t use [`sys.platlibdir`](https://docs.python.org/3/library/sys.html#sys.platlibdir "sys.platlibdir"). Patch by Victor Stinner.
  * [bpo-45052](https://bugs.python.org/issue?@action=redirect&bpo=45052): `WithProcessesTestSharedMemory.test_shared_memory_basics` test was ignored, because `self.assertEqual(sms.size, sms2.size)` line was failing. It is now removed and test is unskipped.
The main motivation for this line to be removed from the test is that the `size` of `SharedMemory` is not ever guaranteed to be the same. It is decided by the platform.
  * [bpo-44895](https://bugs.python.org/issue?@action=redirect&bpo=44895): libregrtest now clears the type cache later to reduce the risk of false alarm when checking for reference leaks. Previously, the type cache was cleared too early and libregrtest raised a false alarm about reference leaks under very specific conditions. Patch by Irit Katriel and Victor Stinner.
  * [bpo-45042](https://bugs.python.org/issue?@action=redirect&bpo=45042): Fixes that test classes decorated with `@hashlib_helper.requires_hashdigest` were skipped all the time.
  * [bpo-25130](https://bugs.python.org/issue?@action=redirect&bpo=25130): Add calls of [`gc.collect()`](https://docs.python.org/3/library/gc.html#gc.collect "gc.collect") in tests to support PyPy.
  * [bpo-45011](https://bugs.python.org/issue?@action=redirect&bpo=45011): Made tests relying on the `_asyncio` C extension module optional to allow running on alternative Python implementations. Patch by Serhiy Storchaka.
  * [bpo-44949](https://bugs.python.org/issue?@action=redirect&bpo=44949): Fix auto history tests of test_readline: sometimes, the newline character is not written at the end, so don’t expect it in the output.
  * [bpo-44891](https://bugs.python.org/issue?@action=redirect&bpo=44891): Tests were added to clarify [`id()`](https://docs.python.org/3/library/functions.html#id "id") is preserved when `obj * 1` is used on [`str`](https://docs.python.org/3/library/stdtypes.html#str "str") and [`bytes`](https://docs.python.org/3/library/stdtypes.html#bytes "bytes") objects. Patch by Nikita Sobolev.
  * [bpo-44852](https://bugs.python.org/issue?@action=redirect&bpo=44852): Add ability to wholesale silence DeprecationWarnings while running the regression test suite.
  * [bpo-40928](https://bugs.python.org/issue?@action=redirect&bpo=40928): Notify users running test_decimal regression tests on macOS of potential harmless “malloc can’t allocate region” messages spewed by test_decimal.
  * [bpo-44734](https://bugs.python.org/issue?@action=redirect&bpo=44734): Fixed floating-point precision issue in turtle tests.
  * [bpo-44708](https://bugs.python.org/issue?@action=redirect&bpo=44708): Regression tests, when run with -w, are now re-running only the affected test methods instead of re-running the entire test file.
  * [bpo-42095](https://bugs.python.org/issue?@action=redirect&bpo=42095): Added interop tests for Apple pl