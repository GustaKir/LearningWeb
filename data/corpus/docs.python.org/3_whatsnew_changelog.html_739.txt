Title: Python Library Enhancements
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This section details various improvements and fixes in the Python library, including resource management in tokenize.open(), enhancements to smtplib for debugging, automatic authentication in urllib.request, a regression fix in urljoin(), and the addition of _curses.update_lines_cols().
---

### Library[¶](https://docs.python.org/3/whatsnew/changelog.html#id776 "Link to this heading")
  * [bpo-23840](https://bugs.python.org/issue?@action=redirect&bpo=23840): tokenize.open() now closes the temporary binary file on error to fix a resource warning.
  * [bpo-16914](https://bugs.python.org/issue?@action=redirect&bpo=16914): new debuglevel 2 in smtplib adds timestamps to debug output.
  * [bpo-7159](https://bugs.python.org/issue?@action=redirect&bpo=7159): urllib.request now supports sending auth credentials automatically after the first 401. This enhancement is a superset of the enhancement from [bpo-19494](https://bugs.python.org/issue?@action=redirect&bpo=19494) and supersedes that change.
  * [bpo-23703](https://bugs.python.org/issue?@action=redirect&bpo=23703): Fix a regression in urljoin() introduced in 901e4e52b20a. Patch by Demian Brecht.
  * [bpo-4254](https://bugs.python.org/issue?@action=redirect&bpo=4254): Adds _curses.update_lines_cols(). Patch by Arnon Yaari
  * [bpo-19933](https://bugs.python.org/issue?@action=redirect&bpo=19933): Provide default argument for ndigits in round. Patch by Vajrasky Kok.
  * [bpo-23193](https://bugs.python.org/issue?@action=redirect&bpo=23193): Add a numeric_owner parameter to tarfile.TarFile.extract and tarfile.TarFile.extractall. Patch by Michael Vogt and Eric Smith.
  * [bpo-23342](https://bugs.python.org/issue?@action=redirect&bpo=23342): Add a subprocess.run() function than returns a CalledProcess instance for a more consistent API than the existing call* functions.
  * [bpo-21217](https://bugs.python.org/issue?@action=redirect&bpo=21217): inspect.getsourcelines() now tries to compute the start and end lines from the code object, fixing an issue when a lambda function is used as decorator argument. Patch by Thomas Ballinger and Allison Kaptur.
  * [bpo-24521](https://bugs.python.org/issue?@action=redirect&bpo=24521): Fix possible integer overflows in the pickle module.
  * [bpo-22931](https://bugs.python.org/issue?@action=redirect&bpo=22931): Allow ‘[’ and ‘]’ in cookie values.
  * The keywords attribute of functools.partial is now always a dictionary.
  * [bpo-23811](https://bugs.python.org/issue?@action=redirect&bpo=23811): Add missing newline to the PyCompileError error message. Patch by Alex Shkop.
  * [bpo-21116](https://bugs.python.org/issue?@action=redirect&bpo=21116): Avoid blowing memory when allocating a multiprocessing shared array that’s larger than 50% of the available RAM. Patch by Médéric Boquien.
  * [bpo-22982](https://bugs.python.org/issue?@action=redirect&bpo=22982): Improve BOM handling when seeking to multiple positions of a writable text file.
  * [bpo-23464](https://bugs.python.org/issue?@action=redirect&bpo=23464): Removed deprecated asyncio JoinableQueue.
  * [bpo-23529](https://bugs.python.org/issue?@action=redirect&bpo=23529): Limit the size of decompressed data when reading from GzipFile, BZ2File or LZMAFile. This defeats denial of service attacks using compressed bombs (i.e. compressed payloads which decompress to a huge size). Patch by Martin Panter and Nikolaus Rath.
  * [bpo-21859](https://bugs.python.org/issue?@action=redirect&bpo=21859): Added Python implementation of io.FileIO.
  * [bpo-23865](https://bugs.python.org/issue?@action=redirect&bpo=23865): close() methods in multiple modules now are idempotent and more robust at shutdown. If they need to release multiple resources, all are released even if errors occur.
  * [bpo-23400](https://bugs.python.org/issue?@action=redirect&bpo=23400): Raise same exception on both Python 2 and 3 if sem_open is not available. Patch by Davin Potts.
  * [bpo-10838](https://bugs.python.org/issue?@action=redirect&bpo=10838): The subprocess now module includes SubprocessError and TimeoutError in its list of exported names for the users wild enough to use `from subprocess import *`.
  * [bpo-23411](https://bugs.python.org/issue?@action=redirect&bpo=23411): Added DefragResult, ParseResult, SplitResult, DefragResultBytes, ParseResultBytes, and SplitResultBytes to urllib.parse.__all__. Patch by Martin Panter.
  * [bpo-23881](https://bugs.python.org/issue?@action=redirect&bpo=23881): urllib.request.ftpwrapper constructor now closes the socket if the FTP connection failed to fix a ResourceWarning.
  * [bpo-23853](https://bugs.python.org/issue?@action=redirect&bpo=23853): [`socket.socket.sendall()`](https://docs.python.org/3/library/socket.html#socket.socket.sendall "socket.socket.sendall") does no more reset the socket timeout each time data is sent successfully. The socket timeout is now the maximum total duration to send all data.
  * [bpo-22721](https://bugs.python.org/issue?@action=redirect&bpo=22721): An order of multiline pprint output of set or dict containing orderable and non-orderable elements no longer depends on iteration order of set or dict.
  * [bpo-15133](https://bugs.python.org/issue?@action=redirect&bpo=15133): _tkinter.tkapp.getboolean() now supports Tcl_Obj and always ret