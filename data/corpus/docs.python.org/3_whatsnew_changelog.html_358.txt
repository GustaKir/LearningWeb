Title: Python Version Updates and Bug Fixes
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This document outlines recent changes in Python, including the addition of SNI support in ssl.get_server_certificate(), new statistical functionalities to the statistics module, the introduction of a locale.localize() function, and a fix for a regression in ctypes.c_wchar_p handling.
---

Previously a [`KeyError`](https://docs.python.org/3/library/exceptions.html#KeyError "KeyError") exception could be raised on Windows when the `"USERNAME"` environment variable was unset.
  * [bpo-36076](https://bugs.python.org/issue?@action=redirect&bpo=36076): Added SNI support to [`ssl.get_server_certificate()`](https://docs.python.org/3/library/ssl.html#ssl.get_server_certificate "ssl.get_server_certificate").
  * [bpo-38490](https://bugs.python.org/issue?@action=redirect&bpo=38490): Covariance, Pearson’s correlation, and simple linear regression functionality was added to statistics module. Patch by Tymoteusz Wołodźko.
  * [bpo-33731](https://bugs.python.org/issue?@action=redirect&bpo=33731): Provide a locale.localize() function, which converts a normalized number string into a locale format.
  * [bpo-32745](https://bugs.python.org/issue?@action=redirect&bpo=32745): Fix a regression in the handling of ctypes’ [`ctypes.c_wchar_p`](https://docs.python.org/3/library/ctypes.html#ctypes.c_wchar_p "ctypes.c_wchar_p") type: embedded null characters would cause a [`ValueError`](https://docs.python.org/3/library/exceptions.html#ValueError "ValueError") to be raised. Patch by Zackery Spytz.


### Documentation[¶](https://docs.python.org/3/whatsnew/changelog.html#id292 "Link to this heading")
  * [bpo-43987](https://bugs.python.org/issue?@action=redirect&bpo=43987): Add “Annotations Best Practices” document as a new HOWTO.
  * [bpo-43977](https://bugs.python.org/issue?@action=redirect&bpo=43977): Document the new [`Py_TPFLAGS_MAPPING`](https://docs.python.org/3/c-api/typeobj.html#c.Py_TPFLAGS_MAPPING "Py_TPFLAGS_MAPPING") and [`Py_TPFLAGS_SEQUENCE`](https://docs.python.org/3/c-api/typeobj.html#c.Py_TPFLAGS_SEQUENCE "Py_TPFLAGS_SEQUENCE") type flags.
  * [bpo-43959](https://bugs.python.org/issue?@action=redirect&bpo=43959): The documentation on the PyContextVar C-API was clarified.
  * [bpo-43938](https://bugs.python.org/issue?@action=redirect&bpo=43938): Update dataclasses documentation to express that FrozenInstanceError is derived from AttributeError.
  * [bpo-43778](https://bugs.python.org/issue?@action=redirect&bpo=43778): Fix the Sphinx glossary_search extension: create the _static/ sub-directory if it doesn’t exist.
  * [bpo-43755](https://bugs.python.org/issue?@action=redirect&bpo=43755): Update documentation to reflect that unparenthesized lambda expressions can no longer be the expression part in an `if` clause in comprehensions and generator expressions since Python 3.9.
  * [bpo-43739](https://bugs.python.org/issue?@action=redirect&bpo=43739): Fixing the example code in Doc/extending/extending.rst to declare and initialize the pmodule variable to be of the right type.


### Tests[¶](https://docs.python.org/3/whatsnew/changelog.html#id293 "Link to this heading")
  * [bpo-43961](https://bugs.python.org/issue?@action=redirect&bpo=43961): Fix test_logging.test_namer_rotator_inheritance() on Windows: use [`os.replace()`](https://docs.python.org/3/library/os.html#os.replace "os.replace") rather than [`os.rename()`](https://docs.python.org/3/library/os.html#os.rename "os.rename"). Patch by Victor Stinner.
  * [bpo-43842](https://bugs.python.org/issue?@action=redirect&bpo=43842): Fix a race condition in the SMTP test of test_logging. Don’t close a file descriptor (socket) from a different thread while asyncore.loop() is polling the file descriptor. Patch by Victor Stinner.
  * [bpo-43843](https://bugs.python.org/issue?@action=redirect&bpo=43843): `test.libregrtest` now marks a test as ENV_CHANGED (altered the execution environment) if a thread raises an exception but does not catch it. It sets a hook on [`threading.excepthook()`](https://docs.python.org/3/library/threading.html#threading.excepthook "threading.excepthook"). Use `--fail-env-changed` option to mark the test as failed. Patch by Victor Stinner.
  * [bpo-43811](https://bugs.python.org/issue?@action=redirect&bpo=43811): Tests multiple OpenSSL versions on GitHub Actions. Use ccache to speed up testing.
  * [bpo-43791](https://bugs.python.org/issue?@action=redirect&bpo=43791): OpenSSL 3.0.0: Disable testing of legacy protocols TLS 1.0 and 1.1. Tests are failing with TLSV1_ALERT_INTERNAL_ERROR.


### Build[¶](https://docs.python.org/3/whatsnew/changelog.html#id294 "Link to this heading")
  * [bpo-43567](https://bugs.python.org/issue?@action=redirect&bpo=43567): Improved generated code refresh (AST/tokens/opcodes/keywords) on Windows.
  * [bpo-43669](https://bugs.python.org/issue?@action=redirect&bpo=43669): Implement [**PEP 644**](https://peps.python.org/pep-0644/). Python now requires OpenSSL 1.1.1 or newer.