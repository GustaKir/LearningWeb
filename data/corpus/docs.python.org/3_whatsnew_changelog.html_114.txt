Title: Fixes in tempfile and getpass Modules
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This patch includes fixes for several bugs: `tempfile.TemporaryDirectory` now properly cleans up without dereferencing symlinks and raises the correct `PermissionError` on Windows. Additionally, `getpass.getuser()` was updated to raise `OSError` for all failures instead of `ImportError`.
---

Patch by Matthias Bussonnier and Adam Chhina.
  * [gh-91133](https://github.com/python/cpython/issues/91133): Fix a bug in [`tempfile.TemporaryDirectory`](https://docs.python.org/3/library/tempfile.html#tempfile.TemporaryDirectory "tempfile.TemporaryDirectory") cleanup, which now no longer dereferences symlinks when working around file system permission errors.
  * [bpo-43153](https://bugs.python.org/issue?@action=redirect&bpo=43153): On Windows, `tempfile.TemporaryDirectory` previously masked a `PermissionError` with `NotADirectoryError` during directory cleanup. It now correctly raises `PermissionError` if errors are not ignored. Patch by Andrei Kulakov and Ken Jin.
  * [bpo-32731](https://bugs.python.org/issue?@action=redirect&bpo=32731): [`getpass.getuser()`](https://docs.python.org/3/library/getpass.html#getpass.getuser "getpass.getuser") now raises [`OSError`](https://docs.python.org/3/library/exceptions.html#OSError "OSError") for all failures rather than [`ImportError`](https://docs.python.org/3/library/exceptions.html#ImportError "ImportError") on systems lacking the [`pwd`](https://docs.python.org/3/library/pwd.html#module-pwd "pwd: The password database \(getpwnam\(\) and friends\). \(Unix\)") module or [`KeyError`](https://docs.python.org/3/library/exceptions.html#KeyError "KeyError") if the password database is empty.
  * [bpo-34321](https://bugs.python.org/issue?@action=redirect&bpo=34321): [`mmap.mmap`](https://docs.python.org/3/library/mmap.html#mmap.mmap "mmap.mmap") now has a _trackfd_ parameter on Unix; if it is `False`, the file descriptor specified by _fileno_ will not be duplicated.
  * [bpo-35332](https://bugs.python.org/issue?@action=redirect&bpo=35332): The [`shutil.rmtree()`](https://docs.python.org/3/library/shutil.html#shutil.rmtree "shutil.rmtree") function now ignores errors when calling [`os.close()`](https://docs.python.org/3/library/os.html#os.close "os.close") when _ignore_errors_ is `True`, and [`os.close()`](https://docs.python.org/3/library/os.html#os.close "os.close") no longer retried after error.
  * [bpo-35928](https://bugs.python.org/issue?@action=redirect&bpo=35928): [`io.TextIOWrapper`](https://docs.python.org/3/library/io.html#io.TextIOWrapper "io.TextIOWrapper") now correctly handles the decoding buffer after `read()` and `write()`.
  * [bpo-26791](https://bugs.python.org/issue?@action=redirect&bpo=26791): [`shutil.move()`](https://docs.python.org/3/library/shutil.html#shutil.move "shutil.move") now moves a symlink into a directory when that directory is the target of the symlink. This provides the same behavior as the mv shell command. The previous behavior raised an exception. Patch by Jeffrey Kintscher.
  * [bpo-41422](https://bugs.python.org/issue?@action=redirect&bpo=41422): Fixed memory leaks of [`pickle.Pickler`](https://docs.python.org/3/library/pickle.html#pickle.Pickler "pickle.Pickler") and [`pickle.Unpickler`](https://docs.python.org/3/library/pickle.html#pickle.Unpickler "pickle.Unpickler") involving cyclic references via the internal memo mapping.
  * [bpo-19821](https://bugs.python.org/issue?@action=redirect&bpo=19821): The `pydoc.ispackage()` function has been deprecated.
  * [bpo-40262](https://bugs.python.org/issue?@action=redirect&bpo=40262): The `ssl.SSLSocket.recv_into()` method no longer requires the _buffer_ argument to implement `__len__` and supports buffers with arbitrary item size.
  * [bpo-39912](https://bugs.python.org/issue?@action=redirect&bpo=39912): [`warnings.filterwarnings()`](https://docs.python.org/3/library/warnings.html#warnings.filterwarnings "warnings.filterwarnings") and [`warnings.simplefilter()`](https://docs.python.org/3/library/warnings.html#warnings.simplefilter "warnings.simplefilter") now raise appropriate exceptions instead of `AssertionError`. Patch contributed by RÃ©mi Lapeyre.
  * [bpo-37260](https://bugs.python.org/issue?@action=redirect&bpo=37260): Fixed a race condition in [`shutil.rmtree()`](https://docs.python.org/3/library/shutil.html#shutil.rmtree "shutil.rmtree") in which directory entries removed by another process or thread while `shutil.rmtree()` is running can cause it to raise FileNotFoundError. Patch by Jeffrey Kintscher.
  * [bpo-36959](https://bugs.python.org/issue?@action=redirect&bpo=36959): Fix some error messages for invalid ISO format string combinations in `strptime()` that referred to directives not contained in the format string. Patch by Gordon P.