Title: Improved Test Management in Python's Regression Testing
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This documentation chunk outlines updates to Python's regression testing framework, including the use of the -rerun option for verbose testing, the skipping of certain tests under specific build configurations, and the introduction of new options for fast and slow continuous integration testing. These changes aim to enhance test efficiency and reliability.
---

the –rerun option is used, the test is now re-run in verbose mode in a fresh process. Patch by Victor Stinner.
  * [gh-103053](https://github.com/python/cpython/issues/103053): Skip test_freeze_simple_script() of test_tools.test_freeze if Python is built with `./configure --enable-optimizations`, which means with Profile Guided Optimization (PGO): it just makes the test too slow. The freeze tool is tested by many other CIs with other (faster) compiler flags. Patch by Victor Stinner.
  * [gh-109580](https://github.com/python/cpython/issues/109580): Skip `test_perf_profiler` if Python is built with ASAN, MSAN or UBSAN sanitizer. Python does crash randomly in this test on such build. Patch by Victor Stinner.
  * [gh-109566](https://github.com/python/cpython/issues/109566): regrtest: Add `--fast-ci` and `--slow-ci` options. `--fast-ci` uses a default timeout of 10 minutes and `-u all,-cpu` (skip slowest tests). `--slow-ci` uses a default timeout of 20 minutes and `-u all` (run all tests). Patch by Victor Stinner.
  * [gh-109425](https://github.com/python/cpython/issues/109425): libregrtest now decodes stdout of test worker processes with the “backslashreplace” error handler to log corrupted stdout, instead of failing with an error and not logging the stdout. Patch by Victor Stinner.
  * [gh-109396](https://github.com/python/cpython/issues/109396): Fix `test_socket.test_hmac_sha1()` in FIPS mode. Use a longer key: FIPS mode requires at least of at least 112 bits. The previous key was only 32 bits. Patch by Victor Stinner.
  * [gh-104736](https://github.com/python/cpython/issues/104736): Fix test_gdb on Python built with LLVM clang 16 on Linux ppc64le (ex: Fedora 38). Search patterns in gdb “bt” command output to detect when gdb fails to retrieve the traceback. For example, skip a test if `Backtrace stopped: frame did not save the PC` is found. Patch by Victor Stinner.
  * [gh-109276](https://github.com/python/cpython/issues/109276): libregrtest now calls [`random.seed()`](https://docs.python.org/3/library/random.html#random.seed "random.seed") before running each test file when `-r/--randomize` command line option is used. Moreover, it’s also called in worker processes. It should help to make tests more deterministic. Previously, it was only called once in the main process before running all test files and it was not called in worker processes. Patch by Victor Stinner.
  * [gh-109276](https://github.com/python/cpython/issues/109276): libregrtest now uses a separated file descriptor to write test result as JSON. Previously, if a test wrote debug messages late around the JSON, the main test process failed to parse JSON. Patch by Victor Stinner.
  * [gh-108996](https://github.com/python/cpython/issues/108996): Fix and enable `test_msvcrt`.
  * [gh-109237](https://github.com/python/cpython/issues/109237): Fix `test_site.test_underpth_basic()` when the working directory contains at least one non-ASCII character: encode the `._pth` file to UTF-8 and enable the UTF-8 Mode to use UTF-8 for the child process stdout. Patch by Victor Stinner.
  * [gh-109230](https://github.com/python/cpython/issues/109230): Fix `test_pyexpat.test_exception()`: it can now be run from a directory different than Python source code directory. Before, the test failed in this case. Skip the test if Modules/pyexpat.c source is not available. Skip also the test on Python implementations other than CPython. Patch by Victor Stinner.
  * [gh-108996](https://github.com/python/cpython/issues/108996): Add tests for `msvcrt`.
  * [gh-109015](https://github.com/python/cpython/issues/109015): Fix test_asyncio, test_imaplib and test_socket tests on FreeBSD if the TCP blackhole is enabled (`sysctl net.inet.tcp.blackhole`). Skip the few tests which failed with `ETIMEDOUT` which such non standard configuration. Currently, the [FreeBSD GCP image enables TCP and UDP blackhole](https://reviews.freebsd.org/D41751) (`sysctl net.inet.tcp.blackhole=2` and `sysctl net.inet.udp.blackhole=1`). Patch by Victor Stinner.
  * [gh-91960](https://github.com/python/cpython/issues/91960): Skip `test_gdb` if gdb is unable to retrieve Python frame objects: if a frame is `<optimized out>`. When Python is built with “clang -Og”, gdb can fail to retrieve the _frame_ parameter of `_PyEval_EvalFrameDefault()`. In this case, tests like `py_bt()` are likely to fail. Without getting access to Python frames, `python-gdb.py` is mostly clueless on retrieving the Python traceback. Moreover, `test_gdb` is no longer skipped on macOS if Python is built with Clang. Patch by Victor Stinner.
  * [gh-108962](https://github.com/python/cpython/issues/108962): Skip `test_tempfile.test_flags()` if `chflags()` fails with “OSError: [Errno 45] Operation not supported” (ex: on FreeBSD 13).