Title: Python 3. Feature Updates and Fixes
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This document provides an overview of several patches and updates in Python 3. Key changes include the introduction of FreeBSD 13.2 CI support via Cirrus-CI, removal of the `test_main()` function for tests, fixes to `test_tomllib` recursion tests for WASI buildbots, and the addition of new functions `get_recursion_available()` and `get_recursion_depth()` to the `test.support` module.
---

Patch by Victor Stinner.
  * [gh-91960](https://github.com/python/cpython/issues/91960): FreeBSD 13.2 CI coverage for pull requests is now provided by Cirrus-CI (a hosted CI service that supports Linux, macOS, Windows, and FreeBSD).
  * [gh-89392](https://github.com/python/cpython/issues/89392): Removed support of `test_main()` function in tests. They now always use normal unittest test runner.
  * [gh-108851](https://github.com/python/cpython/issues/108851): Fix `test_tomllib` recursion tests for WASI buildbots: reduce the recursion limit and compute the maximum nested array/dict depending on the current available recursion limit. Patch by Victor Stinner.
  * [gh-108851](https://github.com/python/cpython/issues/108851): Add `get_recursion_available()` and `get_recursion_depth()` functions to the [`test.support`](https://docs.python.org/3/library/test.html#module-test.support "test.support: Support for Python's regression test suite.") module. Patch by Victor Stinner.
  * [gh-108834](https://github.com/python/cpython/issues/108834): Add `--fail-rerun option` option to regrtest: if a test failed when then passed when rerun in verbose mode, exit the process with exit code 2 (error), instead of exit code 0 (success). Patch by Victor Stinner.
  * [gh-108834](https://github.com/python/cpython/issues/108834): Rename regrtest `--verbose2` option (`-w`) to `--rerun`. Keep `--verbose2` as a deprecated alias. Patch by Victor Stinner.
  * [gh-108834](https://github.com/python/cpython/issues/108834): When regrtest reruns failed tests in verbose mode (`./python -m test --rerun`), tests are now rerun in fresh worker processes rather than being executed in the main process. If a test does crash or is killed by a timeout, the main process can detect and handle the killed worker process. Tests are rerun in parallel if the `-jN` option is used to run tests in parallel. Patch by Victor Stinner.
  * [gh-108822](https://github.com/python/cpython/issues/108822): `regrtest` now computes statistics on all tests: successes, failures and skipped. `test_netrc`, `test_pep646_syntax` and `test_xml_etree` now return results in their `test_main()` function. Patch by Victor Stinner and Alex Waygood.
  * [gh-108794](https://github.com/python/cpython/issues/108794): The [`doctest.DocTestRunner.run()`](https://docs.python.org/3/library/doctest.html#doctest.DocTestRunner.run "doctest.DocTestRunner.run") method now counts the number of skipped tests. Add [`doctest.DocTestRunner.skips`](https://docs.python.org/3/library/doctest.html#doctest.DocTestRunner.skips "doctest.DocTestRunner.skips") and [`doctest.TestResults.skipped`](https://docs.python.org/3/library/doctest.html#doctest.TestResults.skipped "doctest.TestResults.skipped") attributes. Patch by Victor Stinner.
  * [gh-108388](https://github.com/python/cpython/issues/108388): Convert test_concurrent_futures to a package of 7 sub-tests. Patch by Victor Stinner.
  * [gh-108388](https://github.com/python/cpython/issues/108388): Split test_multiprocessing_fork, test_multiprocessing_forkserver and test_multiprocessing_spawn into test packages. Each package is made of 4 sub-tests: processes, threads, manager and misc. It allows running more tests in parallel and so reduce the total test duration. Patch by Victor Stinner.
  * [gh-105776](https://github.com/python/cpython/issues/105776): Fix test_cppext when the C compiler command `-std=c11` option: remove `-std=` options from the compiler command. Patch by Victor Stinner.
  * [gh-107652](https://github.com/python/cpython/issues/107652): Set up CIFuzz to run fuzz targets in GitHub Actions. Patch by Illia Volochii.
  * [gh-107237](https://github.com/python/cpython/issues/107237): `test_logging`: Fix `test_udp_reconnection()` by increasing the timeout from 100 ms to 5 minutes (LONG_TIMEOUT). Patch by Victor Stinner.
  * [gh-107178](https://github.com/python/cpython/issues/107178): Add the C API test for functions in the Mapping Protocol, the Sequence Protocol and some functions in the Object Protocol.
  * [gh-106714](https://github.com/python/cpython/issues/106714): test_capi: Fix test_no_FatalError_infinite_loop() to no longer write a coredump, by using test.support.SuppressCrashReport. Patch by Victor Stinner.
  * [gh-104090](https://github.com/python/cpython/issues/104090): Avoid creating a reference to the test object in [`collectedDurations()`](https://docs.python.org/3/library/unittest.html#unittest.TestResult.collectedDurations "unittest.TestResult.collectedDurations").
  * [gh-106752](https://github.com/python/cpython/issues/106752): Moved tests for `zipfile.Path` into `Lib/test/test_zipfile/_path`.