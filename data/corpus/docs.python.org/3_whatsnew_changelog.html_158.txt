Title: Test Fixes and Improvements
URL: https://docs.python.org/3/whatsnew/changelog.html
Summary: This section details several fixes to Python tests, including resolving deadlocks in test_socket, improving test_stress_modifying_handlers, and adjusting test_tools.test_freeze for FreeBSD. The fixes were primarily implemented by Victor Stinner.
---

### Tests[¶](https://docs.python.org/3/whatsnew/changelog.html#id134 "Link to this heading")
  * [gh-110647](https://github.com/python/cpython/issues/110647): Fix test_stress_modifying_handlers() of test_signal. Patch by Victor Stinner.
  * [gh-103053](https://github.com/python/cpython/issues/103053): Fix test_tools.test_freeze on FreeBSD: run “make distclean” instead of “make clean” in the copied source directory to remove also the “python” program. Patch by Victor Stinner.
  * [gh-110167](https://github.com/python/cpython/issues/110167): Fix a deadlock in test_socket when server fails with a timeout but the client is still running in its thread. Don’t hold a lock to call cleanup functions in doCleanups(). One of the cleanup function waits until the client completes, whereas the client could deadlock if it called addCleanup() in such situation. Patch by Victor Stinner.
  * [gh-110388](https://github.com/python/cpython/issues/110388): Add tests for [`tty`](https://docs.python.org/3/library/tty.html#module-tty "tty: Utility functions that perform common terminal control operations. \(Unix\)").
  * [gh-81002](https://github.com/python/cpython/issues/81002): Add tests for [`termios`](https://docs.python.org/3/library/termios.html#module-termios "termios: POSIX style tty control. \(Unix\)").
  * [gh-110367](https://github.com/python/cpython/issues/110367): regrtest: When using worker processes (-jN) with –verbose3 option, regrtest can now display the worker output even if a worker process does crash. Previously, sys.stdout and sys.stderr were replaced and so the worker output was lost on a crash. Patch by Victor Stinner.
  * [gh-110267](https://github.com/python/cpython/issues/110267): Add tests for pickling and copying PyStructSequence objects. Patched by Xuehai Pan.
  * [gh-110171](https://github.com/python/cpython/issues/110171): `libregrtest` now always sets and shows `random.seed`, so tests are more reproducible. Use `--randseed` flag to pass the explicit random seed for tests.
  * [gh-110152](https://github.com/python/cpython/issues/110152): Remove `Tools/scripts/run_tests.py` and `make hostrunnertest`. Just run `./python -m test --slow-ci`, `make buildbottest` or `make test` instead. Python test runner (regrtest) now handles cross-compilation and HOSTRUNNER. It also adds options to Python such fast `-u -E -W default -bb` when `--fast-ci` or `--slow-ci` option is used. Patch by Victor Stinner.
  * [gh-110031](https://github.com/python/cpython/issues/110031): Skip test_threading tests using thread+fork if Python is built with Address Sanitizer (ASAN). Patch by Victor Stinner.
  * [gh-110088](https://github.com/python/cpython/issues/110088): Fix test_asyncio timeouts: don’t measure the maximum duration, a test should not measure a CI performance. Only measure the minimum duration when a task has a timeout or delay. Add `CLOCK_RES` to `test_asyncio.utils`. Patch by Victor Stinner.
  * [gh-109974](https://github.com/python/cpython/issues/109974): Fix race conditions in test_threading lock tests. Wait until a condition is met rather than using [`time.sleep()`](https://docs.python.org/3/library/time.html#time.sleep "time.sleep") with a hardcoded number of seconds. Patch by Victor Stinner.
  * [gh-110033](https://github.com/python/cpython/issues/110033): Fix `test_interprocess_signal()` of `test_signal`. Make sure that the `subprocess.Popen` object is deleted before the test raising an exception in a signal handler. Otherwise, `Popen.__del__()` can get the exception which is logged as `Exception ignored in: ...` and the test fails. Patch by Victor Stinner.
  * [gh-109594](https://github.com/python/cpython/issues/109594): Fix test_timeout() of test_concurrent_futures.test_wait. Remove the future which may or may not complete depending if it takes longer than the timeout or not. Keep the second future which does not complete before wait() timeout. Patch by Victor Stinner.
  * [gh-109972](https://github.com/python/cpython/issues/109972): Split test_gdb.py file into a test_gdb package made of multiple tests, so tests can now be run in parallel. Patch by Victor Stinner.
  * [gh-109566](https://github.com/python/cpython/issues/109566): regrtest: When `--fast-ci` or `--slow-ci` option is used, regrtest now replaces the current process with a new process to add `-u -W default -bb -E` options to Python. Patch by Victor Stinner.
  * [gh-109748](https://github.com/python/cpython/issues/109748): Fix `test_zippath_from_non_installed_posix()` of test_venv: don’t copy `__pycache__/` sub-directories, because they can be modified by other Python tests running in parallel. Patch by Victor Stinner.
  * [gh-109739](https://github.com/python/cpython/issues/109739): regrtest: Fix reference leak check on Windows. Disable the load tracker on Windows in the reference leak check mode (-R option). Patch by Victor Stinner.
  * [gh-109276](https://github.com/python/cpython/issues/109276): regrtest: When a test fails with “env changed” and