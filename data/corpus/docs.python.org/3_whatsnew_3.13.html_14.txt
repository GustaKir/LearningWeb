Title: ctypes Enhancements in Python 3.13
URL: https://docs.python.org/3/whatsnew/3.13.html
Summary: In Python 3.13, ctypes undergoes internal refactoring affecting how internal metaclasses are initialized, requiring subclass projects to adjust custom logic from __new__ to __init__. Additionally, ctypes.Structure gains a new _align_ attribute for struct alignment during memory operations.
---

### ctypes[¶](https://docs.python.org/3/whatsnew/3.13.html#ctypes "Link to this heading")
  * As a consequence of necessary internal refactoring, initialization of internal metaclasses now happens in `__init__` rather than in `__new__`. This affects projects that subclass these internal metaclasses to provide custom initialization. Generally:
    * Custom logic that was done in `__new__` after calling `super().__new__` should be moved to `__init__`.
    * To create a class, call the metaclass, not only the metaclass’s `__new__` method.
See [gh-124520](https://github.com/python/cpython/issues/124520) for discussion and links to changes in some affected projects.
  * [`ctypes.Structure`](https://docs.python.org/3/library/ctypes.html#ctypes.Structure "ctypes.Structure") objects have a new [`_align_`](https://docs.python.org/3/library/ctypes.html#ctypes.Structure._align_ "ctypes.Structure._align_") attribute which allows the alignment of the structure being packed to/from memory to be specified explicitly. (Contributed by Matt Sanderson in [gh-112433](https://github.com/python/cpython/issues/112433))


### dbm[¶](https://docs.python.org/3/whatsnew/3.13.html#dbm "Link to this heading")
  * Add [`dbm.sqlite3`](https://docs.python.org/3/library/dbm.html#module-dbm.sqlite3 "dbm.sqlite3: SQLite backend for dbm \(All\)"), a new module which implements an SQLite backend, and make it the default `dbm` backend. (Contributed by Raymond Hettinger and Erlend E. Aasland in [gh-100414](https://github.com/python/cpython/issues/100414).)
  * Allow removing all items from the database through the new [`gdbm.clear()`](https://docs.python.org/3/library/dbm.html#dbm.gnu.gdbm.clear "dbm.gnu.gdbm.clear") and [`ndbm.clear()`](https://docs.python.org/3/library/dbm.html#dbm.ndbm.ndbm.clear "dbm.ndbm.ndbm.clear") methods. (Contributed by Donghee Na in [gh-107122](https://github.com/python/cpython/issues/107122).)


### dis[¶](https://docs.python.org/3/whatsnew/3.13.html#dis "Link to this heading")
  * Change the output of [`dis`](https://docs.python.org/3/library/dis.html#module-dis "dis: Disassembler for Python bytecode.") module functions to show logical labels for jump targets and exception handlers, rather than offsets. The offsets can be added with the new [`-O`](https://docs.python.org/3/library/dis.html#cmdoption-dis-O) command-line option or the _show_offsets_ argument. (Contributed by Irit Katriel in [gh-112137](https://github.com/python/cpython/issues/112137).)
  * [`get_instructions()`](https://docs.python.org/3/library/dis.html#dis.get_instructions "dis.get_instructions") no longer represents cache entries as separate instructions. Instead, it returns them as part of the [`Instruction`](https://docs.python.org/3/library/dis.html#dis.Instruction "dis.Instruction"), in the new _cache_info_ field. The _show_caches_ argument to [`get_instructions()`](https://docs.python.org/3/library/dis.html#dis.get_instructions "dis.get_instructions") is deprecated and no longer has any effect. (Contributed by Irit Katriel in [gh-112962](https://github.com/python/cpython/issues/112962).)


### doctest[¶](https://docs.python.org/3/whatsnew/3.13.html#doctest "Link to this heading")
  * [`doctest`](https://docs.python.org/3/library/doctest.html#module-doctest "doctest: Test pieces of code within docstrings.") output is now colored by default. This can be controlled via the new [`PYTHON_COLORS`](https://docs.python.org/3/using/cmdline.html#envvar-PYTHON_COLORS) environment variable as well as the canonical [`NO_COLOR`](https://no-color.org/) and [`FORCE_COLOR`](https://force-color.org/) environment variables. See also [Controlling color](https://docs.python.org/3/using/cmdline.html#using-on-controlling-color). (Contributed by Hugo van Kemenade in [gh-117225](https://github.com/python/cpython/issues/117225).)
  * The [`DocTestRunner.run()`](https://docs.python.org/3/library/doctest.html#doctest.DocTestRunner.run "doctest.DocTestRunner.run") method now counts the number of skipped tests. Add the [`DocTestRunner.skips`](https://docs.python.org/3/library/doctest.html#doctest.DocTestRunner.skips "doctest.DocTestRunner.skips") and [`TestResults.skipped`](https://docs.python.org/3/library/doctest.html#doctest.TestResults.skipped "doctest.TestResults.skipped") attributes. (Contributed by Victor Stinner in [gh-108794](https://github.com/python/cpython/issues/108794).)