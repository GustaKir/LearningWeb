Title: Annotate an Altair Chart with Streamlit
URL: https://docs.streamlit.io/develop/tutorials/elements/annotate-an-altair-chart
Summary: This tutorial guides you through creating a time-series chart to track stock prices using Streamlit and Altair. It involves constructing a layered chart with a data layer and an annotation layer, incorporating multi-line tooltips for data point details.
---

## [](https://docs.streamlit.io/develop/tutorials/elements/annotate-an-altair-chart#prerequisites)Prerequisites
  * This tutorial requires the following Python libraries:
`streamlit altair>=4.0.0 vega_datasets `
  * This tutorial assumes you have a clean working directory called `your-repository`.
  * You should have a basic understanding of the Vega-Altair charting library.


## [](https://docs.streamlit.io/develop/tutorials/elements/annotate-an-altair-chart#summary)Summary
In this example, you will create a time-series chart to track the evolution of stock prices. The chart will have two layers: a data layer and an annotation layer. Each layer is an `altair.Chart` object. You will combine the two charts with the `+` opterator to create a layered chart.
Within the data layer, you'll add a multi-line tooltip to show information about datapoints. To learn more about multi-line tooltips, see this [example](https://altair-viz.github.io/gallery/multiline_tooltip.html) in Vega-Altair's documentation. You'll add another tooltip to the annotation layer.
Here's a look at what you'll build:
Complete code _expand_more_
`import streamlit as st import altair as alt import pandas as pd from vega_datasets import data  @st.cache_data def get_data():   source = data.stocks()   source = source[source.date.gt("2004-01-01")] return source  stock_data = get_data() hover = alt.selection_single(   fields=["date"],   nearest=True,   on="mouseover",   empty="none", ) lines = (   alt.Chart(stock_data, title="Evolution of stock prices") .mark_line() .encode(     x="date",     y="price",     color="symbol", ) ) points = lines.transform_filter(hover).mark_circle(size=65) tooltips = (   alt.Chart(stock_data) .mark_rule() .encode(     x="yearmonthdate(date)",     y="price",     opacity=alt.condition(hover, alt.value(0.3), alt.value(0)),     tooltip=[       alt.Tooltip("date", title="Date"),       alt.Tooltip("price", title="Price (USD)"), ], ) .add_selection(hover) ) data_layer = lines + points + tooltips ANNOTATIONS = [ ("Sep 01, 2007", 450, "ðŸ™‚", "Something's going well for GOOG & AAPL."), ("Nov 01, 2008", 220, "ðŸ™‚", "The market is recovering."), ("Dec 01, 2007", 750, "ðŸ˜±", "Something's going wrong for GOOG & AAPL."), ("Dec 01, 2009", 680, "ðŸ˜±", "A hiccup for GOOG."), ] annotations_df = pd.DataFrame(   ANNOTATIONS, columns=["date", "price", "marker", "description"] ) annotations_df.date = pd.to_datetime(annotations_df.date) annotation_layer = (   alt.Chart(annotations_df) .mark_text(size=20, dx=-10, dy=0, align="left") .encode(x="date:T", y=alt.Y("price:Q"), text="marker", tooltip="description") ) combined_chart = data_layer + annotation_layer st.altair_chart(combined_chart, use_container_width=True) `
[Built with Streamlit ðŸŽˆ](https://streamlit.io)
[Fullscreen _open_in_new_](https://doc-annotate-altair.streamlit.app/?utm_medium=oembed)
## [](https://docs.streamlit.io/develop/tutorials/elements/annotate-an-altair-chart#build-the-example)Build the example
### [](https://docs.streamlit.io/develop/tutorials/elements/annotate-an-altair-chart#initialize-your-app)Initialize your app
  1. In `your_repository`, create a file named `app.py`.
  2. In a terminal, change directories to `your_repository`, and start your app:
`streamlit run app.py `
Your app will be blank because you still need to add code.
  3. In `app.py`, write the following:
` import streamlit as st  import altair as alt  import pandas as pd  from vega_datasets import data `
You'll be using these libraries as follows:
     * You'll download a dataset using [`vega_datasets`](https://pypi.org/project/vega-datasets/).
     * You'll maniputate the data using `pandas`.
     * You'll define a chart using `altair`.
  4. Save your `app.py` file, and view your running app.
  5. In your app, select "**Always rerun** ", or press the "**A** " key.
Your preview will be blank but will automatically update as you save changes to `app.py`.
  6. Return to your code.